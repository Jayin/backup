<!DOCTYPE html>
<html lang="ch">
<head>
<meta charset="utf-8" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
<meta http-equiv="expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-touch-fullscreen" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="format-detection" content="telephone=no" />

<meta name="keywords" content="荧光人类" />
<meta name="description" content="荧光人类" />
<title>ILLUMI RUN</title>

</head>
<body>
<!-- trace:src/app/run-201501/share.html -->
<!-- trace:src/html/layout/layout.base.html -->
<script type="text/javascript">
var G = G || {
	DOMAIN: document.domain,
	ORIGIN: 'http://h5.createcdigital.com',
	CGI_ORIGIN: 'http://h5.createcdigital.com',
	CDN_ORIGIN: 'http://h5.createcdigital.com',
	CDN_CONTEXT: 'static',
	
	MD5_MAP: {"lib/app/main.js":"285c466d","lib/async/main.js":"ab8c2ec0","lib/exif/main.js":"d9220fef","lib/fabric/main.js":"717d91e1","lib/hammer/main.js":"1fa58a18","lib/iscroll/main.js":"a7c22c38","lib/jquery-2.1.3/main.js":"d98ccc9e","lib/mega-pix-image/main.js":"51eb9270","lib/parallax/main.js":"8dda6fef","lib/skateboard/main.js":"323939ac","lib/turn/main.js":"c2ab08cd","lib/zepto-1.1.4/main.js":"b278405b"},

	IS_PROTOTYPE: false,
	
	pageTime: [new Date()]
};

if(G.CDN_CONTEXT) {
	G.CDN_BASE = G.CDN_ORIGIN + '/' + G.CDN_CONTEXT
} else {
	G.CDN_BASE = G.CDN_ORIGIN
}

G.id = function(id) {
	return document.getElementById(id);
};

if(G.DOMAIN && G.DOMAIN != document.domain) {
	document.domain = G.DOMAIN;
}

(function() {
	var list = ['CGI_ORIGIN', 'CDN_ORIGIN'];
	for(var i = 0; i < list.length; i++) {
		if(G[list[i]].indexOf('//') === 0) {
			G[list[i]] = location.protocol + G[list[i]];
		}
	}
	if(location.protocol == 'file:') {
		var m = location.href.match(/^(.+)\/static\//);
		if(m) {
			G.ORIGIN = G.CDN_ORIGIN = G.CGI_ORIGIN = m[1];
		}
	}
})();
</script>

<script type="text/javascript">
document.write([
	'<link rel="stylesheet" href="' + G.CDN_BASE + '/style/app/main.css?v=448ffc0a" />'
].join(''));
</script>

<!-- trace:src/html/inc/loading.inc.html -->
<div id="circleG" class="circleG_wrapper">
	<div id="circleG_1" class="circleG"></div>
	<div id="circleG_2" class="circleG"></div>
	<div id="circleG_3" class="circleG"></div>
</div>

<script type="text/javascript">
document.write([
	'<script type="text/javascript" src="' + G.CDN_BASE + '/script/lib/fastclick/fastclick.js?v=4504535a"></s', 'cript>',
	'<script type="text/javascript" src="' + G.CDN_BASE + '/script/lib/yom/require-lite.js?v=457b1412"></s', 'cript>'
].join(''));
</script>

<script type="text/javascript">
FastClick.attach(document.body);
window.addEventListener('load', function() {
	document.body.className = document.body.className + ' loaded';
}, false);
</script>


<script type="text/javascript">
document.write([
    '<link rel="stylesheet" href="' + G.CDN_ORIGIN + '/static/app/run-201501/style/main.css?v=7ba4d7ea" />'
].join(''));
</script>
<div class="container">
    <div class="share-bg">
        <!-- 重来 -->
        <div id="btn-again" class="btn-again" onclick="location='/static/app/illumirun-201501/index.html'" style="opacity: 1">
            <img src="./image/btn_again.png" height="70" width="70" alt="">
        </div>
        <div class="img-user-img">
            <div class="img-preview">
                <!-- 预览的图片 -->
                <img class="img-preview-size" src="" style="width=50%;height=auto;">
            </div>
        </div>
        <!-- 钻石 -->
        <div class="text-slogan text-slogan-zs">
            <img src="image/style_diamond.png" width="85%">
        </div>
        <!-- 摩登 -->
        <div class="text-slogan text-slogan-md">
            <img src="image/style_modern.png" width="85%">
        </div>
        <!-- 海洋 -->
        <div class="text-slogan text-slogan-hy">
            <img src="image/style_ocean.png" width="85%">
        </div>
        <!-- 泼墨 -->
        <div class="text-slogan text-slogan-jq">
            <img src="image/style_ink.png" width="85%">
        </div>
        <!-- 时代 -->
        <div class="text-slogan text-slogan-sd">
            <img src="image/style_time.png" width="85%">
        </div>
        <!-- 朋友圈进来显示的文案 -->
        <div class="text-slogan text-slogan-timeline">
            <img src="image/style_from_timeline.png" width="85%">
        </div>
        <div class="btn-lottery" onclick="document.getElementById('dialog-win').style.display='block'"></div>
        <div class="btn-ranklist" onclick="document.getElementById('dialog-ranklist').style.display='block'"></div>
        <!-- 中奖框 -->
        <div id="dialog-win" class="modal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <img src="image/prize.png" width="90%">
                    <div class="modal-form">
                        <span>姓名</span>
                        <input id="submit-name" type="text">
                    </div>
                    <div class="modal-form">
                        <span>电话</span>
                        <input id="submit-phone" type="text">
                    </div>
                    <div class="modal-form">
                        <span>性别</span>
                        <span>男</span>
                        <input type="radio" checked="checked" name="sex" value="1" />
                        <span>女</span>
                        <input type="radio" name="sex" value="0" />
                    </div>
                    <div class="modal-form">
                        <button id="btn-submit">提交</button>
                    </div>
                </div>
                <div class="modal-btn-close">
                    <img onclick="document.getElementById('dialog-win').style.display='none'" src="./image/img_close.png" class="img-close" />
                </div>
            </div>
        </div>
        <!-- 提交成功框 -->
        <div id="dialog-submit-ok" class="modal" style="height=250px;">
            <div class="modal-dialog">
                <div class="modal-content" style="margin-top:97px;">
                    <p style="margin-top: 30px;">提交成功~
                    </p>
                </div>
                <div class="modal-btn-close" style="margin-top:65px;">
                    <img onclick="document.getElementById('dialog-submit-ok').style.display='none'" src="./image/img_close.png" class="img-close" />
                </div>
            </div>
        </div>
        <!-- 排行榜 -->
        <div id="dialog-ranklist" class="modal-full">
            <div class="modal-content" style="color: #FF0082;">
                <div class="ranklist-bg" style="color: white;">


                    <div style="height: 20%;width: 30%;position:absolute;top:0;right:0" onclick="document.getElementById('dialog-ranklist').style.display='none'"></div>
                    <!-- 激情 -->
                    <div class="rank-item rank-item-jiqing">
                        <div class="rank-item-txt">
                            <div id="rank-number-jiqing" style="display:inline">
                                0
                            </div>
                        </div>
                        <div style="height: 6px;border: 1px solid #FF0082;border-radius: 5px;">
                            <div id="rank-rating-jiqing" style="background:#FF0082;width:0%;height:100%"></div>
                        </div>
                    </div>
                    <!-- 海洋 -->
                    <div class="rank-item rank-item-haiyang">
                        <div class="rank-item-txt">
                            <div id="rank-number-haiyang" style="display:inline">
                                0
                            </div>
                        </div>
                        <div style="height: 6px;border: 1px solid #FF0082;border-radius: 5px;">
                            <div id="rank-rating-haiyang" style="background:#FF0082;width:0%;height:100%"></div>
                        </div>
                    </div>
                    <!-- 钻石 -->
                    <div class="rank-item rank-item-zuanshi">
                        <div class="rank-item-txt">
                            <div id="rank-number-zuanshi" style="display:inline">
                                0
                            </div>
                        </div>
                        <div style="height: 6px;border: 1px solid #FF0082;border-radius: 5px;">
                            <div id="rank-rating-zuanshi" style="background:#FF0082;width:0%;height:100%"></div>
                        </div>
                    </div>
                    <!-- 摩登 -->
                    <div class="rank-item rank-item-modeng">
                        <div class="rank-item-txt">
                            <div id="rank-number-modeng" style="display:inline">
                                0
                            </div>
                        </div>
                        <div style="height: 6px;border: 1px solid #FF0082;border-radius: 5px;">
                            <div id="rank-rating-modeng" style="background:#FF0082;width:0%;height:100%"></div>
                        </div>
                    </div>
                    <!-- 时代 -->
                    <div class="rank-item rank-item-shidai">
                        <div class="rank-item-txt">
                            <div id="rank-number-shidai" style="display:inline">
                                0
                            </div>
                        </div>
                        <div style="height: 6px;border: 1px solid #FF0082;border-radius: 5px;">
                            <div id="rank-rating-shidai" style="background:#FF0082;width:0%;height:100%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- trace:src/app/run-201501/script/mod/share/main.coffee -->
<script type="text/javascript">
(function() {
  require(['jquery', 'app', 'http://res.wx.qq.com/open/js/jweixin-1.0.0.js'], function($, app, wx) {
    var designId, frame, getUrlParameter, loadDesign, loadRanklist, need_height, templateCode;
    designId = null;
    templateCode = "sd";
    getUrlParameter = function(sParam) {
      var i, j, ref, sPageURL, sParameterName, sURLVariables;
      sPageURL = window.location.search.substring(1);
      sURLVariables = sPageURL.split('&');
      for (i = j = 0, ref = sURLVariables.length; 0 <= ref ? j < ref : j > ref; i = 0 <= ref ? ++j : --j) {
        sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] === sParam) {
          return sParameterName[1];
        }
      }
      return null;
    };
    loadDesign = function(designId) {
      return app.ajax.get({
        url: "web/run/design/" + designId,
        success: function(result) {
          if (!G.IS_PROTOTYPE) {
            return $(".img-preview-size").attr('src', "/" + result.data.relativePath);
          } else {
            return $(".img-preview-size").attr('src', result.data.relativePath);
          }
        }
      });
    };
    loadRanklist = function() {
      return app.ajax.get({
        url: 'web/run/templates.json',
        success: function(result) {
          var haiyang, jiqing, modeng, shidai, total, zuanshi;
          jiqing = result.data.templates[3].number;
          haiyang = result.data.templates[2].number;
          zuanshi = result.data.templates[4].number;
          modeng = result.data.templates[0].number;
          shidai = result.data.templates[1].number;
          total = jiqing + haiyang + zuanshi + modeng + shidai;
          $('#rank-number-jiqing').text(jiqing + '');
          $('#rank-number-haiyang').text(haiyang + '');
          $('#rank-number-zuanshi').text(zuanshi + '');
          $('#rank-number-modeng').text(modeng + '');
          $('#rank-number-shidai').text(shidai + '');
          $('#rank-rating-jiqing').css('width', (jiqing / total * 100) + '%');
          $('#rank-rating-haiyang').css('width', (haiyang / total * 100) + '%');
          $('#rank-rating-zuanshi').css('width', (zuanshi / total * 100) + '%');
          $('#rank-rating-modeng').css('width', (modeng / total * 100) + '%');
          return $('#rank-rating-shidai').css('width', (shidai / total * 100) + '%');
        },
        error: function() {
          return alert('系统繁忙，请您稍后重试。');
        }
      });
    };
    designId = getUrlParameter("designId");
    templateCode = getUrlParameter("templateCode");
    frame = templateCode;
    loadDesign(designId);
    loadRanklist();
    window.onload = function() {
      return app.ajax.hideLoading();
    };
    need_height = document.body.clientWidth * 1207 / 750;
    (function() {
      $('.share-bg').css('background-size', document.body.clientWidth + 'px ' + need_height + "px");
      $('.share-bg').css('height', need_height + "px");
      $('.modal-full').css('background-size', document.body.clientWidth + 'px ' + need_height + "px");
      return $('.modal-full').css('height', need_height + "px");
    })();
    $(".text-slogan-" + frame).show();
    return $('#btn-submit').on('click', function() {
      var name, phone, sex;
      name = $("#submit-name").val();
      phone = $("#submit-phone").val();
      sex = parseInt($("input:radio[name ='sex']:checked").val());
      if (!name) {
        alert('名字不能为空');
        return;
      }
      if (!phone) {
        alert('电话不能为空');
        return;
      }
      return app.ajax.post({
        url: "web/run/user",
        contentType: 'application/json; charset=UTF-8',
        data: JSON.stringify({
          name: name,
          phone: phone,
          sex: sex,
          templateCode: templateCode
        }),
        success: function(result) {
          $("#dialog-win").hide();
          return $("#dialog-submit-ok").show();
        },
        error: function(e) {
          return console.log(e);
        }
      });
    });
  });

}).call(this);

</script>
<script>
require(['jquery', 'http://res.wx.qq.com/open/js/jweixin-1.0.0.js', 'app'], function($, wx, app) {
    //var shareUrl = 'http://www.createcdigital.com/yuanxiao/app/bxn-201501/index.html';
    var friendsCountIncrease = function() {
        app.ajax.post({
            url: "web/sharing/increaseSharingFriends/552a705bd4c651f53c7e592c",
            success: function(response) {

                //$(".content").text("put success");
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                //$(".content").text(textStatus);
            }
        });
    };
    var momentsCountIncrease = function() {
        app.ajax.post({
            url: "web/sharing/increaseSharingMoments/552a705bd4c651f53c7e592c",
            success: function(response) {

                //$(".content").text("put success");
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                //$(".content").text(textStatus);
            }
        });
    };
    var shareUrl = location.href.split('#')[0];
    $(document).ready(function() {
        app.ajax.post({
            url: 'web/sharing/signWxshare/54f1b82a58f24d7d16c11e18',
            data: {
                url: shareUrl
            },
            timeout: 1000,
            error: function() {},
            success: function(result) {
                wx.config({
                    debug: false,
                    appId: result.data.appId,
                    timestamp: result.data.timestamp,
                    nonceStr: result.data.nonceStr,
                    signature: result.data.signature,
                    jsApiList: [
                        'onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ', 'onMenuShareWeibo'
                    ]
                });
                wx.ready(function() {
                    // 在这里调用 API
                    wx.onMenuShareTimeline({
                        title: '荧光人类，本色当道！', // 分享标题        
                        link: shareUrl, // 分享链接
                        imgUrl: G.CDN_ORIGIN + '/static/app/run-201501/image/illumi_run_share.jpg', // 分享图标
                        success: function() {
                            // 用户确认分享后执行的回调函数
                            momentsCountIncrease();
                        },
                        cancel: function() {
                            // 用户取消分享后执行的回调函数
                            // $('.close-bt').click();
                        }
                    });
                    wx.onMenuShareAppMessage({

                        title: '荧光人类，本色当道！', // 分享标题        
                        desc: '激情爆棚！快来给我点个赞，让我遇见TA.荧光人类，本色当道！',
                        link: shareUrl, // 分享链接
                        imgUrl: G.CDN_ORIGIN + '/static/app/run-201501/image/illumi_run_share.jpg', // 分享图标
                        type: '', // 分享类型,music、video或link，不填默认为link
                        dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                        success: function() {
                            // 用户确认分享后执行的回调函数
                            friendsCountIncrease();
                        },
                        cancel: function() {
                            // 用户取消分享后执行的回调函数

                        }
                    });
                });
            }
        })
    });
});
</script>

</body>
</html>