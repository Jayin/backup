<!DOCTYPE html>
<html lang="ch">
<head>
<meta charset="utf-8" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
<meta http-equiv="expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-touch-fullscreen" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="format-detection" content="telephone=no" />

<meta name="keywords" content="荧光人类" />
<meta name="description" content="荧光人类" />
<title>荧光人类</title>

</head>
<body>
<!-- trace:src/app/run-201501/index.html -->
<!-- trace:src/html/layout/layout.base.html -->
<script type="text/javascript">
var G = G || {
	DOMAIN: document.domain,
	ORIGIN: 'http://h5.createcdigital.com',
	CGI_ORIGIN: 'http://h5.createcdigital.com',
	CDN_ORIGIN: 'http://h5.createcdigital.com',
	CDN_CONTEXT: 'static',
	
	MD5_MAP: {"lib/app/main.js":"285c466d","lib/async/main.js":"ab8c2ec0","lib/exif/main.js":"d9220fef","lib/fabric/main.js":"717d91e1","lib/hammer/main.js":"1fa58a18","lib/iscroll/main.js":"a7c22c38","lib/jquery-2.1.3/main.js":"d98ccc9e","lib/mega-pix-image/main.js":"51eb9270","lib/parallax/main.js":"8dda6fef","lib/skateboard/main.js":"323939ac","lib/turn/main.js":"c2ab08cd","lib/zepto-1.1.4/main.js":"b278405b"},

	IS_PROTOTYPE: false,
	
	pageTime: [new Date()]
};

if(G.CDN_CONTEXT) {
	G.CDN_BASE = G.CDN_ORIGIN + '/' + G.CDN_CONTEXT
} else {
	G.CDN_BASE = G.CDN_ORIGIN
}

G.id = function(id) {
	return document.getElementById(id);
};

if(G.DOMAIN && G.DOMAIN != document.domain) {
	document.domain = G.DOMAIN;
}

(function() {
	var list = ['CGI_ORIGIN', 'CDN_ORIGIN'];
	for(var i = 0; i < list.length; i++) {
		if(G[list[i]].indexOf('//') === 0) {
			G[list[i]] = location.protocol + G[list[i]];
		}
	}
	if(location.protocol == 'file:') {
		var m = location.href.match(/^(.+)\/static\//);
		if(m) {
			G.ORIGIN = G.CDN_ORIGIN = G.CGI_ORIGIN = m[1];
		}
	}
})();
</script>

<script type="text/javascript">
document.write([
	'<link rel="stylesheet" href="' + G.CDN_BASE + '/style/app/main.css?v=448ffc0a" />'
].join(''));
</script>

<!-- trace:src/html/inc/loading.inc.html -->
<div id="circleG" class="circleG_wrapper">
	<div id="circleG_1" class="circleG"></div>
	<div id="circleG_2" class="circleG"></div>
	<div id="circleG_3" class="circleG"></div>
</div>

<script type="text/javascript">
document.write([
	'<script type="text/javascript" src="' + G.CDN_BASE + '/script/lib/fastclick/fastclick.js?v=4504535a"></s', 'cript>',
	'<script type="text/javascript" src="' + G.CDN_BASE + '/script/lib/yom/require-lite.js?v=457b1412"></s', 'cript>'
].join(''));
</script>

<script type="text/javascript">
FastClick.attach(document.body);
window.addEventListener('load', function() {
	document.body.className = document.body.className + ' loaded';
}, false);
</script>


<script type="text/javascript">
document.write([
    '<link rel="stylesheet" href="' + G.CDN_ORIGIN + '/static/app/run-201501/style/main.css?v=7ba4d7ea" />'
].join(''));
</script>
<div class="container">
    <!-- 主页 -->
    <div class="index-bg  hidden" >
        <div class="camera">
            <img src="./image/camera.png" height="80" width="80">
            <input id="btn-upload" class="input-upload" type="file" capture="camera" accept="image/*">
        </div>
        <div class="txt-activity-rule">
            <a onclick="document.getElementById('dialog').style.display='block'">活动规则</a>
        </div>
        <!-- 活动规则框 -->
        <div id="dialog" class="modal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <p>世界只有一个，地球只有一个</p>
                    <p>人类有N中，你是哪一种</p>
                    <p><strong>我们是荧光人类</strong></p>
                    <p>赶紧拿起手机拍照吧，或者从相册中选取一张，点击你喜欢的模板、道具、口号从现在开始，你就是荧光人类的主角带上你的小伙伴一起疯狂夜跑吧</p>
                </div>
                <div class="modal-btn-close">
                    <img onclick="document.getElementById('dialog').style.display='none'" src="./image/img_close.png" class="img-close"/>
                </div>
            </div>
        </div>
       <!--  <canvas id="c" class="hidden" width="131" height="234">你的浏览器不支持Canvas</canvas> -->
    </div>

    <!-- 设计页 -->
    <div class="design-bg hidden" >
        <!-- 固定在顶部 -->
        <div class="toolbar">
            <div  id="btn-again" class="toolbar-btn float-left" >
                <img src="./image/btn-replay.png" height="48" width="48" alt="重拍">
            </div>
            <div id="btn-finish" class="toolbar-btn float-right">
                <img src="./image/btn_finish.png" height="48" width="48" alt="完成"></div>
        </div>
        <!-- middle -->
        <div class="edit-body">
            <canvas id="c" class="img-preview-size" height="351" width="197">该浏览器不支持canvas</canvas>
            <div class="hidden">
                <img id="frame_user" src="./image/test_user_img.png" height="234" width="131" alt="用户图片">
                <img id="frame_haiyang" src="./image/frame_haiyang_small.png" height="351" width="197" alt="海洋">
                <img id="frame_jiqing" src="./image/frame_jiqing_small.png" height="351" width="197" alt="激情">
                <img id="frame_modeng" src="./image/frame_modeng_small.png" height="351" width="197" alt="摩登">
                <img id="frame_shidai" src="./image/frame_shidai_small.png" height="351" width="197" alt="时代">
                <img id="frame_zuanshi" src="./image/frame_zuanshi_small.png" height="351" width="197" alt="钻石">
            </div>
        </div>
        <!-- 固定 在底部-->
        <div class="edit-function">
            <div id="btn-shidai" class="edit-function-item">
                <img src="./image/img_fn_item_shidai.png">
            </div>
            <div id="btn-zuanshi" class="edit-function-item">
                <img src="./image/img_fn_item_zuanshi.png">
            </div>
            <div id="btn-modeng" class="edit-function-item">
                <img src="./image/img_fn_item_modeng.png">
            </div>
            <div id="btn-haiyang" class="edit-function-item">
                <img src="./image/img_fn_item_haiyang.png">
            </div>
            <div id="btn-jiqing" class="edit-function-item">
                <img src="./image/img_fn_item_jiqing.png">
            </div>
        </div>
    </div>
</div>
<!-- trace:src/app/run-201501/script/mod/index/main.coffee -->
<script type="text/javascript">
(function() {
  require(['jquery', 'app', 'fabric'], function($, app, fabric) {
    var canvas, frame_haiyang, frame_jiqing, frame_modeng, frame_shidai, frame_tmp, frame_user, frame_zuanshi, need_height, selected_item;
    window.onload = function() {
      return app.ajax.hideLoading();
    };
    need_height = document.body.clientWidth * 1207 / 750;
    (function() {
      $('.index-bg').css('background-size', document.body.clientWidth + 'px ' + need_height + "px");
      $('.index-bg').css('height', need_height + "px");
      $('.camera').css('padding-top', need_height * 0.58 + "px");
      $('.index-bg').show();
      return $('.design-bg').hide();
    })();
    canvas = new fabric.StaticCanvas('c');
    frame_user = new fabric.Image($('#frame_user')[0]);
    frame_haiyang = new fabric.Image($('#frame_haiyang')[0]);
    frame_jiqing = new fabric.Image($('#frame_jiqing')[0]);
    frame_modeng = new fabric.Image($('#frame_modeng')[0]);
    frame_shidai = new fabric.Image($('#frame_shidai')[0]);
    frame_zuanshi = new fabric.Image($('#frame_zuanshi')[0]);
    frame_tmp = frame_shidai;
    selected_item = 0;
    $('#btn-upload').on('change', function() {
      var input, reader;
      input = $(this)[0];
      if (input.files && input.files[0]) {
        reader = new FileReader();
        reader.onload = function(e) {
          var img;
          img = new Image();
          img.src = e.target.result;
          app.ajax.showLoading();
          return img.onload = function() {
            var dest_height, user_pic;
            user_pic = null;
            console.log('width' + img.naturalWidth);
            console.log('height' + img.naturalHeight);
            dest_height = canvas.height > img.naturalHeight ? canvas.height : img.naturalHeight;
            if (img.naturalHeight > img.naturalWidth) {
              user_pic = new fabric.Image(img, {
                left: 0,
                top: 0,
                width: canvas.width,
                height: img.naturalHeight * canvas.width / img.naturalWidth
              });
            } else {
              user_pic = new fabric.Image(img, {
                left: 0,
                top: 0,
                width: img.naturalWidth * canvas.height / img.naturalHeight,
                height: canvas.height
              });
            }
            console.log(user_pic);
            canvas.centerObject(user_pic);
            canvas.add(user_pic);
            canvas.add(frame_tmp);
            console.log(canvas.toDataURL());
            $('.design-bg').show();
            return $('.index-bg').hide();
          };
        };
        return reader.readAsDataURL(input.files[0]);
      }
    });
    $('#btn-shidai').on('click', function() {
      selected_item = 0;
      return canvas.remove(frame_tmp).add(frame_tmp = frame_shidai);
    });
    $('#btn-zuanshi').on('click', function() {
      selected_item = 1;
      return canvas.remove(frame_tmp).add(frame_tmp = frame_zuanshi);
    });
    $('#btn-modeng').on('click', function() {
      selected_item = 2;
      return canvas.remove(frame_tmp).add(frame_tmp = frame_modeng);
    });
    $('#btn-haiyang').on('click', function() {
      selected_item = 3;
      return canvas.remove(frame_tmp).add(frame_tmp = frame_haiyang);
    });
    $('#btn-jiqing').on('click', function() {
      selected_item = 4;
      return canvas.remove(frame_tmp).add(frame_tmp = frame_jiqing);
    });
    $('#btn-again').on('click', function() {
      canvas.dispose();
      $('.design-bg').hide();
      return $('.index-bg').show();
    });
    return $('#btn-finish').on('click', function() {
      var data_imgage;
      data_imgage = canvas.toDataURL('png');
      $.ajax({
        url: 'http://demo.createcdigital.com:8080/wechat/uploadImage/54f1b82a58f24d7d16c11e18.json',
        type: 'post',
        data: JSON.stringify({
          'imgData': data_imgage
        }),
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        error: function() {
          return alert('Error');
        },
        success: function(result) {
          return console.log(result);
        }
      });
      console.log('item you select:' + selected_item);
      return console.log(data_imgage);
    });
  });

}).call(this);

</script>

</body>
</html>