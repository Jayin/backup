(function(){require(["jquery","app"],function(t,e){var n,i,r,a,o,c,s,l,u,g,h,p,f,_,d,m,I,w,b,N,x,O,C,R,v,D,y,k,j,T,E,q;return E={},E.blue=[G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_blue_straight.png",G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_blue_lower_left.png",G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_blue_mid_left.png",G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_blue_top_left.png",G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_blue_lower_right.png",G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_blue_mid_right.png",G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_blue_top_right.png"],E.red=[G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_red_straight.png",G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_red_lower_left.png",G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_red_mid_left.png",G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_red_top_left.png",G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_red_lower_right.png",G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_red_mid_right.png",G.CDN_ORIGIN+"/static/app/bxn-201502/image/action_red_top_right.png"],h=G.CDN_ORIGIN+"/static/app/bxn-201502/image/bg_dance.mp3",p=t("#action_canvas")[0],_=p.getContext("2d"),s=null,a=600,r=1067,u=new Image,g="straight",i=102,n=113,f="black",k=[],T=[4e3,4500,5e3,5500,5800,6100,6600,7300,7800,8300,9e3,9500],C=!1,j=0,e.ajax.showLoading(),R=0,v=8,O=function(t){return function(){return R+=1,v>R?e.ajax.showLoading():(e.ajax.hideLoading(),b())}}(this),o={},o.straight=new Image,o.top_left=new Image,o.mid_left=new Image,o.lower_left=new Image,o.top_right=new Image,o.mid_right=new Image,o.lower_right=new Image,l=t("#audio1")[0],l.onloadeddata=O,u.onload=O,o.straight.onload=O,o.top_left.onload=O,o.mid_left.onload=O,o.lower_left.onload=O,o.top_right.onload=O,o.mid_right.onload=O,o.lower_right.onload=O,o.start=t("#action_start")[0],c={straight:{top:.093,left:.405,deg:0},top_left:{top:.12,left:.362,deg:-5},mid_left:{top:.27,left:-.32,deg:-45},lower_left:{top:.315,left:-.305,deg:-45},top_right:{top:.12,left:.395,deg:-5},mid_right:{top:-.01,left:.775,deg:30},lower_right:{top:-.071,left:.895,deg:45}},I=function(t){return function(){return _.save(),_.drawImage(s,0,0,a,r),_.restore()}}(this),w=function(t){return function(){var t,e,o,s,l,h;return h=c[g],t=h.deg,s=a*h.left,l=r*h.top,o=i,e=n,_.save(),_.rotate(t*Math.PI/180),_.drawImage(u,0,0,u.width,u.height,s,l,o,e),_.restore()}}(this),N=function(t){return function(){return _.save(),_.fillRect(0,0,t.CONTEXT_W,t.CONTEXT_H),_.drawImage(o.start,0,0,a,r),_.restore()}}(this),m=function(t){return function(){return _.clearRect(0,0,a,r),w(),I()}}(this),b=function(t){return function(){return s=o.straight,g="straight",m(),_.save("draw action.start"),_.drawImage(o.start,0,0,a,r),_.restore()}}(this),y=function(t){return function(){var t,n,i,r,a,c;return l.pause(),l.currentTime=0,l.play(),t=0,s=o.straight,g="straight",m(),i=e.util.cloneObject(k,1),r=e.util.cloneObject(T,1),i[i.length]=i[i.length-1],r[r.length]=1e4,a=i.shift(),c=r.shift(),n=function(){return g=a,s=o[a],m(),t=c,a=i.shift(),c=r.shift(),c?setTimeout(function(){return n()},c-t):(b(),C=!1,l.pause(),j+=1,j%2!==0?y():void 0)},setTimeout(function(){return n()},c-t)}}(this),D=function(t){var e,n;return e=document.createElement("a"),e.href=t,n=function(t){var e,n,i,r,a;if(!t)return{};for(r={},t=t.slice(1).split("&"),n=0,e=void 0;n<t.length;)e=t[n].split("="),i=e[0],a=e[1],/\[\]$/.test(i)?(r[i]=r[i]||[],r[i].push(a)):r[i]=a,n++;return r},{protocol:e.protocol,host:e.host,hostname:e.hostname,pathname:e.pathname,search:n(e.search),hash:e.hash}},N(),q=D(window.location),d=q.search.designId,x=q.search.from,x?(t(".group-share-finish-timeline").show(),t(".group-share-finish-default").hide()):(t(".group-share-finish-timeline").hide(),t(".group-share-finish-default").show()),e.ajax.get({url:"web/bxn/design/"+d,success:function(t){var n;return 0===t.code?(u.src=G.CDN_ORIGIN+"/"+t.data.relativePath,n=t.data.color,k=t.data.sequence,l.src=h,l.load(),o.straight.src=E[n][0],o.lower_left.src=E[n][1],o.mid_left.src=E[n][2],o.top_left.src=E[n][3],o.lower_right.src=E[n][4],o.mid_right.src=E[n][5],o.top_right.src=E[n][6]):e.alerts.alert("该视频不存在","info",1500)},error:function(){return e.alerts.alert("系统繁忙，请您稍后重试。","info",1500)}}),t("#btn-play").on("click",function(t){return function(){return v>R?void e.alerts.alert("加载中,请稍等","info",1500):C?void e.alerts.alert("正在播放","info",1e3):(C=!0,y())}}(this)),t("#btn-finish-share").on("click",function(t){return function(){return document.getElementById("dialog-share").style.display="block"}}(this)),t("#btn-finish-again").on("click",function(t){return function(){return window.location="index.html"}}(this)),t("#btn-finish-custom").on("click",function(t){return function(){return window.location="http://www.baoxiniao.com.cn"}}(this)),t("#btn-finish-suprise").on("click",function(t){return function(){return document.getElementById("dialog-suprise").style.display="block"}}(this)),t("#btn-finish-want-play").on("click",function(t){return function(){return window.location="index.html"}}(this))})}).call(this);