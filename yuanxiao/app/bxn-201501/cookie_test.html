
<!DOCTYPE html>
<html lang="ch">
<head>
<meta charset="utf-8" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
<meta http-equiv="expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-touch-fullscreen" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="format-detection" content="telephone=no" />

<meta name="keywords" content="报喜鸟" />
<meta name="description" content="元宵－原来一笑" />
<title>test cookie</title>
<link rel="stylesheet" href="style/basic.css">
<script src="scripts/jquery.main.js" type="text/javascript"></script>
<script src="scripts/jquery.cookie.js" type="text/javascript"></script>
</head>
<script type="text/javascript">
	function getUrlParameter(sParam)
	{
	    var sPageURL = window.location.search.substring(1);
	    var sURLVariables = sPageURL.split('&');
	    for (var i = 0; i < sURLVariables.length; i++) 
	    {
	        var sParameterName = sURLVariables[i].split('=');
	        if (sParameterName[0] == sParam) 
	        {
	            return sParameterName[1];
	        }
	    }
	} 

    var wxOpenId;
	var openIdInCookie = $.cookie('wxopenid');
	if (openIdInCookie == null) {
		var urlParamOpenId = getUrlParameter('code');		
		if (urlParamOpenId == null) {
			var requestOpenIdUrl = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxd4f26aea63a05347&redirect_uri=http://www.createcdigital.com/yuanxiao/app/bxn-201501/cookie_test.html&response_type=code&scope=snsapi_base&state=null#wechat_redirect';
			window.location.href = requestOpenIdUrl;			
		} else {
			$.cookie('wxopenid', urlParamOpenId, {expires: 7, path: '/'});			
			wxOpenId = urlParamOpenId;
		}
	} else {
		wxOpenId = openIdInCookie;
	}

	function showOpenId() {
		alert(wxOpenId);
	}

	function forwardToFinishPage() {
		window.location.href = 'http://www.createcdigital.com/yuanxiao/app/bxn-201501/finish_design.html?designid=123456';	
	}
</script>
<body>
    <button id="showCookie" name="showCookie" type="button" onclick="showOpenId()">Show Cookie</button>
    <button id="finishDesign" name="finishDesign" type="button" onclick="forwardToFinishPage()">Finish</button>
</body>
</html>
