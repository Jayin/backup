
<!DOCTYPE html>
<html lang="ch">
<head>
<meta charset="utf-8" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta http-equiv="pragma" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
<meta http-equiv="expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-touch-fullscreen" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="format-detection" content="telephone=no" />

<meta name="keywords" content="报喜鸟" />
<meta name="description" content="元宵－原来一笑" />
<title>test cookie</title>
<link rel="stylesheet" href="style/basic.css">
<script src="scripts/jquery-1.7.1.min.js" type="text/javascript"></script>
<script src="scripts/jquery.cookie.js" type="text/javascript"></script>
</head>
<script type="text/javascript">
	function getUrlParameter(sParam)
	{
	    var sPageURL = window.location.search.substring(1);
	    var sURLVariables = sPageURL.split('&');
	    for (var i = 0; i < sURLVariables.length; i++) 
	    {
	        var sParameterName = sURLVariables[i].split('=');
	        if (sParameterName[0] == sParam) 
	        {
	            return sParameterName[1];
	        }
	    }
	} 

    var wxOpenId;
	var openIdInCookie = $.cookie('wxopenid');
	var paramDesignId = getUrlParameter('designid');	
	if (openIdInCookie == null) {
		var urlParamOpenId = getUrlParameter('code');		
		if (urlParamOpenId == null) {
			alert('redirect weixin');
			var redirectUrl = 'http://www.createcdigital.com/yuanxiao/app/bxn-201501/finish_design.html?designid='+paramDesignId;
			var requestOpenIdUrl = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxd4f26aea63a05347&redirect_uri='+redirectUrl+'&response_type=code&scope=snsapi_base&state=null#wechat_redirect';
			window.location.href = requestOpenIdUrl;			
		} else {
			$.cookie('wxopenid', urlParamOpenId, {expires: 7, path: '/'});			
			wxOpenId = urlParamOpenId;
		}
	} else {
		wxOpenId = openIdInCookie;
	}

	function showOpenId() {
		alert(wxOpenId);
	}

	function showDesignId() {
		alert('designId='+paramDesignId);
	}
</script>
<body>
    <button id="showCookie" name="showCookie" type="button" onclick="showOpenId()">Show Cookie</button>
    <button id="finishDesign" name="finishDesign" type="button" onclick="">Like</button>
    <button id="designId" name="designId" type="button" onclick="showDesignId()">Show DesignId</button>
</body>
<script type="text/javascript">
var G = G || {
	DOMAIN: document.domain,
	ORIGIN: location.protocol + '//' + location.host,
	CGI_ORIGIN: location.protocol + '//' + location.host,
	CDN_ORIGIN: location.protocol + '//' + location.host,

	IS_PROTOTYPE: false,
	
	pageTime: [new Date()]
};


</script>
<script type="text/javascript">
document.write([	
	'<script type="text/javascript" src="' + G.CDN_ORIGIN + '/yuanxiao/script/lib/yom/require-lite.js?v=264196d2fba0d537fc879eea896719c2"></s', 'cript>'
].join(''));
</script>
<script>
require(['http://res.wx.qq.com/open/js/jweixin-1.0.0.js'], function(wx) {
	//var shareUrl = 'http://www.createcdigital.com/yuanxiao/app/bxn-201501/index.html';
	var shareUrl = location.href.split('#')[0];
	alert(shareUrl);
	$(document).ready(function() {
		$.ajax({
				url:'http://www.createcdigital.com:8080/wechat/sharing/signWxshare/54f1b82a58f24d7d16c11e16.json',
				type:'post',
				data:JSON.stringify({url: shareUrl}),
				dataType:'json',
				contentType: "application/json;charset=utf-8",
				timeout:1000,
				error:function(){alert('Error');},
				success:function(result) {
					  wx.config({
					    debug: true,
					    appId: result.data.appId,
							timestamp: result.data.timestamp,
							nonceStr: result.data.nonceStr,
							signature: result.data.signature,
					    jsApiList: [
					      'onMenuShareTimeline','onMenuShareAppMessage','onMenuShareQQ','onMenuShareWeibo'
					    ]
					  });
					  wx.ready(function () {
					    // 在这里调用 API
					    wx.onMenuShareTimeline({
					        title: '888元报喜鸟衬衫时常出没,timeline', // 分享标题        
					        link: shareUrl, // 分享链接
					        imgUrl: 'http://www.createcdigital.com/yuanxiao/app/bxn-201501/share.jpg', // 分享图标
					        success: function () { 
					        	alert('timeline');
					        },
					        cancel: function () { 
					            // 用户取消分享后执行的回调函数
					           // $('.close-bt').click();
					        }
					    });
					    wx.onMenuShareAppMessage({
							
					        title: '元宵·原来一笑', // 分享标题        
					        desc: '元宵报喜!我是第friend',
					        link: shareUrl, // 分享链接
					        imgUrl: 'http://www.createcdigital.com/yuanxiao/app/bxn-201501/share.jpg', // 分享图标
					        type: '', // 分享类型,music、video或link，不填默认为link
					        dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
					        success: function () {
					        	alert('friend'); 
					        },
					        cancel: function () { 
					            // 用户取消分享后执行的回调函数
					            
					        }
					    });
					  });
				}
			})
		  });
	});	
</script>
</html>
